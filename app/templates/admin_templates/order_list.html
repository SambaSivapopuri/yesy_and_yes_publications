{% extends "admin_templates/base.html" %}
{% load static %}
{% block content %}

<section class="section">
  <div class="card">
    
    <div class="card-body">
      {% if messages %}
            {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
          {{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        {% endfor %}
        {% endif %}
      <h5 class="card-title">Select Date Between</h5>
      <form action="" method="post"> {% csrf_token %}
        <div class="row ">
          <div class="col-md-4">
            <label for="from_date">Start Date</label>
            <input type="date" name="from_date" id="from_date" class="form-control" max="{{ today|date:'Y-m-d' }}">
          </div>
          <div class="col-md-4">
            <label for="end_date">End Date</label>
            <input type="date" name="end_date" id="end_date" class="form-control" max="{{ today|date:'Y-m-d' }}">
          </div>
          <div class="col-md-4"><br>
            <input type="submit" name="submit" id="submit" class="btn btn-primary" value="Submit">
          </div>
        </div>
      </form>
    </div>
  </div>
  <div class="row">
    <div class="col-lg-12">
      <div class="card">
        
        <div class="card-body">
          <div class="card-title ">
            <button class="btn btn-primary" onclick="window.location.href='{% url 'download_orders' 'csv' %}'">Download
              CSV</button>
            <button class="btn btn-primary" onclick="window.location.href='{% url 'download_orders' 'excel' %}'">Download
              Excel</button>
            <button class="btn btn-primary" onclick="window.location.href='{% url 'download_orders' 'pdf' %}'">Download
              PDF</button>
          </div>
          <h5 class="card-title">Order List</h5>

          <!-- Table Container (Fixed Header & Scrollable Body) -->
          <div style="max-height: 400px; overflow-y: auto; border: 1px solid #ddd;">
            <table class="table datatable" style="width: 100%; border-collapse: collapse;">
              <thead style="position: sticky; top: 0; background: white; z-index: 2;">
                <tr>
                  <th style="min-width: 50px;">S.No</th>
                  <th style="min-width: 100px;">Number</th>
                  <th style="min-width: 120px;">Date</th>
                  <th style="min-width: 120px;">Product Name</th>
                  <th style="min-width: 120px;">Quantity</th>
                  <th style="min-width: 120px;">Order No</th>
                  <th style="min-width: 120px;">Payent Status</th>
                  <th style="min-width: 120px;">Pay Amount</th>
                  <th style="min-width: 120px;">Name</th>
                  <th style="min-width: 120px;">Phone No</th>
                  <th style="min-width: 120px;">Preview</th>
                  <th style="min-width: 120px;">Track Post</th>
                  <th style="min-width: 120px;">Address</th>
                  <th style="min-width: 120px;">Zipcode</th>
                  <th style="min-width: 100px;">Transaction Id</th>
                  <th style="min-width: 100px;">Seller Name</th>
                  <th style="min-width: 140px;">Action</th>
                  <th style="min-width: 180px;">Barcode</th>
                  <th style="min-width: 150px;">City</th>
                  <th style="min-width: 100px;">Address</th>
                  <th style="min-width: 100px;">Edit</th>

                </tr>
              </thead>
              <tbody>
                {% for order in page_obj %}
                <tr>
                  <td><input type="checkbox" id="select_all" onclick="toggleAll(this)">{{ forloop.counter }}</td>
                  <td>{{ order.customer.order.id}}</td>
                  {% comment %} <td><img src="{% if product.image %}{{ product.image.url }} {% endif %}" width="50">
                  </td> {% endcomment %}
                  <td>{{ order.customer.order.created_at|date:"d-m-Y" }}</td>
                  <td>{{ order.customer.order.product.name }}</td>
                  <td>1</td>
                  <td>{{ order.customer.order.order_number }}</td>
                  <td>
                    {% if not order.status %}
                    <span class="badge bg-danger">Not Available</span>
                    {% else %}
                    <span class="badge bg-success">success</span>
                    {% endif %}
                  </td>
                  <td>{{ order.total_price}}</td>
                  <td>{{ order.customer.customer_name }}</td>
                  <td>{{ order.customer.customer_phone }}</td>
                  <td><button class="btn btn-info" data-bs-toggle="modal" data-bs-target="#previewModal{{ order.id }}">
                    Preview
                  </button>
              
                  <!-- Modal -->
                  <div class="modal fade" id="previewModal{{ order.id }}" tabindex="-1" aria-labelledby="previewModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                      <div class="modal-content">
                        <div class="modal-header">
                          <h5 class="modal-title" id="previewModalLabel">Order Preview - {{ order.customer.order.id }}</h5>
                          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body p_data">
                          <input type="button" id="btn" class="btn btn-primary" value="Print" onclick="printDiv();" style="float:right;">
                          <div id="divprint">
                            <div class="row">
                              <b style="font-weight: 700; color:#000; font-size: 18px;"><u>Yes & Yes Books Publications - Order ID - 4001955231</u></b>
                              <div class="col-md-7"></div>
                              <div class="col-md-5 text-end">
                                <p><b>To :</b> {{ order.customer.customer_name }}<br>
                                  {{ order.customer.relation }}. {{ order.customer.relation_name }}<br>
                                  Door No:{{ order.customer.doorno }}<br>
                                  {{ order.customer.address_line1 }}<br>
                                  {% if address_line2 %}{{ order.customer.address_line2 }}{% endif %}</p>
                                <p><b>Mobile:</b> {{ order.customer.customer_phone }}</p>
                                <p><b>Order Id:</b> {{ order.customer.order.order_number }}</p>
                                <p><b>Ordered Date:</b> {{ order.customer.order.created_at|date:"d-m-y" }}
                                </p>
                                <p><b>Payment Method:</b> Online</p>
                                <p><b>Transaction Id:</b> {{ order.transaction_id }}</p>
                              </div>
                            </div>
                          </div>
                          <br>
                          <p><b>From :</b><br>
                            YES PUBLICATIONS<br>
                            # 29-28-39, Surya Plaza, Dasari Vari Street,<br>
                            Suryaraopet, VIJAYAWADA-520 002<br>
                            Cell: 7377 222 999</p>
                            <div class="table-responsive">
                              <table class="table table-striped">
                                <thead>
                                  <tr>
                                    <th>Sr No.</th>
                                    <th>Product Name</th>
                                    <th>Product Image</th>
                                    <th>Discount</th>
                                    <th>Product Price</th>
                                    <th>Discount</th>
                                    <th>Product Qty</th>
                                    <th>Product Total</th>
                                  </tr>
                                </thead>
                                <tbody>
                                  <tr>
                                    <td>1</td>
                                    <td>{{ order.customer.order.product }}</td>
                                    <td><img src="product/1728410075AP DSC-2024 (9 Books Pkg) EM.jpg" width="100px"></td>
                                    <td>30%</td>
                                    <td>3330</td>
                                    <td>999</td>
                                    <td>1</td>
                                    <td>2331</td>
                                  </tr>
                                </tbody>
                              </table>
                            </div>
                        </div>
                        <div class="modal-footer">
                          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        </div>
                      </div>
                    </div>
                  </div>
                </td>
                  <td><a href="{% url 'track_order' order.id%}"><button class="btn btn-primary">Track</button></a></td>
                  <td>{{ order.customer.address_line1 }}</td>
                  <td>{{ order.customer.zipcode }}</td>
                  <td>{{ order.transaction_id}}</td>

                  <td>
                    {{ order.customer.order.product.seller_name_or_shop_name}}
                  </td>
                  <td>Action</td>
                  <td>Barcode</td>
                  <td>{{order.customer.city}}</td>
                  <td>{{order.customer.address_line1}}</td>
                  <td>
                    <a class="btn btn-sm btn-primary"  href="{% url 'update_order' order.customer.order.id %}">
                      <i class="bi bi-pencil-square"></i> Edit
                    </a>
                  </td>
                </tr>
                {% endfor %}
              </tbody>

            </table>
          </div>
          <!-- End Table Container -->

        </div>
      </div>
    </div>
  </div>
</section>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('from_date').setAttribute('max', today);
    document.getElementById('end_date').setAttribute('max', today);
  });
</script>
{% endblock %}